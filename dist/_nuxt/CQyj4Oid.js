import{_ as U}from"./Bm1qAGry.js";import{Q as G}from"./C8jYtfrE.js";import{d as N,c as P,w as I,a5 as Q,R as v,B as m,J as e,u as y,I as A,a6 as E,a7 as X,V as k,M as $,N as h,a8 as Z,q as ee,L as F,Q as z,a9 as te,f as Y,D as le,H as R}from"./BShxNmUg.js";import{D as ne,I as se}from"./zXpsPJkB.js";import{u as oe,I as J}from"./CbkGJgCa.js";import{u as ae,_ as D,a as ie}from"./BOzVj4_F.js";import{u as M,a as j}from"./Cs2E4OOq.js";import"./CUs8Q34q.js";const ue={class:"userInfo"},re={class:"userInfo__head"},de={key:0},ce={key:0,class:"user_toggle__w"},pe={class:"user__toggle"},_e={class:"switch"},ve={class:"userInfo__variant"},me={key:0,class:"userInfo_btn__auth"},ye={key:1,class:"userInfoForm"},ge={class:"userInfoForm__input"},he={class:"userInfoForm__input"},fe={class:"userInfoForm__input"},be={key:1,class:"userInfoData"},ke=N({__name:"BlockUserInfo",setup(C){const{data:n,user:d}=ae(),{currentOrder:c}=M(),{openModal:i}=oe(),u=P(!1),l=P({name:"Константинопольская Кристина",phone:"+7 (918) 123 45 67",email:"dundub@gmail.com"});I(()=>d.value,a=>{var t,r,b,_,B,S,w,p,s;a&&(l.value={name:((b=(r=(t=n.value)==null?void 0:t.meta)==null?void 0:r.billing_first_name)==null?void 0:b[0])||a.name,phone:((S=(B=(_=n.value)==null?void 0:_.meta)==null?void 0:B.billing_phone)==null?void 0:S[0])||a.phone,email:((s=(p=(w=n.value)==null?void 0:w.meta)==null?void 0:p.billing_email)==null?void 0:s[0])||a.email})},{immediate:!0});const o=()=>{u.value||(l.value={name:"Константинопольская Кристина",phone:"+7 (918) 123 45 67",email:"dundub@gmail.com"})};return I(l,a=>{c.value={...c.value,user:{name:a.name,phone:a.phone,email:a.email},billing:{...c.value.billing,first_name:a.name,phone:a.phone,email:a.email},shipping:{...c.value.shipping,first_name:a.name,phone:a.phone,email:a.email}}},{deep:!0}),Q(()=>{c.value={...c.value,user:{name:l.value.name,phone:l.value.phone,email:l.value.email},billing:{...c.value.billing,first_name:l.value.name,phone:l.value.phone,email:l.value.email},shipping:{...c.value.shipping,first_name:l.value.name,phone:l.value.phone,email:l.value.email}}}),(a,t)=>{var r,b;return v(),m("div",ue,[e("div",re,[t[5]||(t[5]=e("h3",null,"Информация о покупателе",-1)),!y(d)&&!((r=y(d))!=null&&r.token)?(v(),m("p",de," Авторизуйтесь, чтобы отслеживать свой заказ ")):A("",!0)]),!y(d)&&!((b=y(d))!=null&&b.token)?(v(),m("div",ce,[e("div",pe,[e("label",_e,[E(e("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=_=>u.value=_),onChange:o},null,544),[[X,u.value]]),t[6]||(t[6]=e("span",{class:"slider round"},null,-1))]),t[7]||(t[7]=e("span",null,"Продолжить без авторизации",-1))]),e("div",ve,[u.value?(v(),m("div",ye,[e("div",ge,[t[8]||(t[8]=e("p",null,"Имя*",-1)),k(J,{modelValue:l.value.name,"onUpdate:modelValue":t[2]||(t[2]=_=>l.value.name=_),placeholder:"Поддубная Елена"},null,8,["modelValue"])]),e("div",he,[t[9]||(t[9]=e("p",null,"Телефон*",-1)),k(se,{modelValue:l.value.phone,"onUpdate:modelValue":t[3]||(t[3]=_=>l.value.phone=_),placeholder:"+7 (918) 123 45 67"},null,8,["modelValue"])]),e("div",fe,[t[10]||(t[10]=e("p",null,"E-mail",-1)),k(J,{modelValue:l.value.email,"onUpdate:modelValue":t[4]||(t[4]=_=>l.value.email=_),placeholder:"dundub@gmail.com",type:"email"},null,8,["modelValue"])])])):(v(),m("div",me,[k(ne,{name:"Войти или зарегистрироваться",type:"secondary",color:"black",size:"large",onClick:t[1]||(t[1]=_=>y(i)("auth"))})]))])])):(v(),m("div",be,[e("p",null,[t[11]||(t[11]=e("strong",null,"Имя:",-1)),$(" "+h(l.value.name),1)]),e("p",null,[t[12]||(t[12]=e("strong",null,"Телефон:",-1)),$(" "+h(l.value.phone),1)]),e("p",null,[t[13]||(t[13]=e("strong",null,"Email:",-1)),$(" "+h(l.value.email),1)])]))])}}}),Pe=D(ke,[["__scopeId","data-v-937881f7"]]),$e={"Москва и Московская область":{price:1500,cities:{Москва:1500,Мытищи:1e3,Химки:1e3}},"Крупные города":{price:1e3,cities:{"Санкт-Петербург":1e3,Казань:1e3,Новосибирск:1e3,Екатеринбург:1e3}}},x={regions:$e,default:{base_price:500,price_per_km:20}},V=P(""),q=P([]),L=P(""),T=P(null),W=P(0),K=()=>{const C=async()=>{if(V.value.length>1)try{const i=await ie.post("https://suggestions.dadata.ru/suggestions/api/4_1/rs/suggest/address",{query:V.value},{headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Token cab538d49b7cbc9ae1d154721028bbbbb0130b57"}});q.value=i.data.suggestions}catch(i){console.error("Error fetching suggestions:",i)}else q.value=[]},n=i=>{V.value=i.value,L.value=JSON.stringify(i.data),T.value=i.data.geo_lat&&i.data.geo_lon?[i.data.geo_lon,i.data.geo_lat]:null,q.value=[],d()},d=()=>{const i=JSON.parse(L.value);let u=0;if(i.region_with_type.includes("Москва")||i.region_with_type.includes("Московская обл")?u=x.regions["Москва и Московская область"].price:Object.keys(x.regions).forEach(l=>{const o=x.regions[l];o.cities&&o.cities[i.city]&&(u=o.cities[i.city])}),u===0&&T.value){const l=x.default,o=c(T.value);u=l.base_price+o*l.price_per_km}W.value=u},c=i=>10;return{query:V,suggestions:q,selectedAddress:L,destinationCoordinates:T,deliveryPrice:W,fetchSuggestions:C,selectSuggestion:n,calculateDeliveryPrice:d}},Ce={class:"delivery"},Ie={class:"delivery__address"},Se={key:0,class:"delivery_siqqestion"},we=["onClick"],Be=N({__name:"BlockDeliveryCalc",setup(C){const{query:n,suggestions:d,deliveryPrice:c,fetchSuggestions:i,selectSuggestion:u,selectedAddress:l}=K(),{currentOrder:o}=M();return I([l],a=>{const t=JSON.parse(a);o.value={...o.value,shipping:{...o.value.shipping,address_1:`${t.street_with_type||""} ${t.house||""}`,city:t.city||"",postcode:t.postal_code||"",country:t.country_iso_code||"RU",region:t.region_with_type||"",price:c.value},billing:{...o.value.billing,address_1:`${t.street_with_type||""} ${t.house||""}`,city:t.city||"",postcode:t.postal_code||"",country:t.country_iso_code||"RU",region:t.region_with_type||""}}}),(a,t)=>(v(),m("div",Ce,[e("div",Ie,[t[2]||(t[2]=e("h3",null,"Доставка",-1)),t[3]||(t[3]=e("p",null,"Адрес",-1)),E(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=r=>ee(n)?n.value=r:null),onInput:t[1]||(t[1]=(...r)=>y(i)&&y(i)(...r)),placeholder:"Введите адрес"},null,544),[[Z,y(n)]]),y(d).length?(v(),m("ul",Se,[(v(!0),m(F,null,z(y(d),r=>(v(),m("li",{key:r,onClick:b=>y(u)(r)},h(r.value),9,we))),128))])):A("",!0)])]))}}),xe=D(Be,[["__scopeId","data-v-dcbbe56b"]]);function Ve(){const{createOrder:C}=j(),n=P(null);function d({amount:u,methods:l,buttonContainerId:o,widgetContainerId:a}){if(n.value){try{n.value.destroy()}catch(r){console.error("Ошибка при уничтожении сессии:",r)}n.value=null}const t={env:window.YaPay.Sandbox,version:4,currencyCode:window.YaPay.CurrencyCode.Rub,merchantId:"4d715c56-1ac9-49bc-9330-889e3487b2c1",totalAmount:u,availablePaymentMethods:l};console.log(t.totalAmount),window.YaPay.createSession(t,{onPayButtonClick:async()=>{C()}}).then(r=>{n.value=r;const b=document.querySelector(o);if(b?n.value.mountButton(b,{type:l.includes("SPLIT")?window.YaPay.ButtonType.Split:window.YaPay.ButtonType.Pay,theme:window.YaPay.ButtonTheme.Black,width:window.YaPay.ButtonWidth.Auto}):console.error("Контейнер для кнопки не найден:",o),l.includes("SPLIT")){const _=document.querySelector(a);_?(_.innerHTML="",n.value.mountWidget(_,{widgetType:window.YaPay.WidgetType.Info,widgetTheme:window.YaPay.WidgetTheme.Light,borderRadius:8})):console.error("Контейнер для виджета не найден:",a)}}).catch(r=>{console.error("Ошибка создания сессии",r)})}function c(){if(n.value){try{n.value.destroy()}catch(u){console.error("Ошибка при уничтожении сессии:",u)}n.value=null}}function i(u,l,o){const a=document.querySelector(u);if(n.value&&a)try{n.value.unmountButton(a)}catch(t){console.error("Ошибка при удалении кнопки:",t)}d({amount:l,methods:o,buttonContainerId:u})}return{createPaymentSession:d,resetPaymentSession:c,resetPaymentButton:i}}const qe={class:"payment"},Te={class:"payment__method"},Ae=["id","value"],De=["for"],Me=["src"],Oe={key:0,class:"split__w"},Ye={__name:"BlockPayment",setup(C){const n=P("Оплата картой онлайн или через СБП"),{currentOrder:d}=M(),{createPaymentSession:c,resetPaymentSession:i}=Ve(),u=[{name:"Оплата картой онлайн или через СБП"},{name:"Оплатить",logo:"/img/split.png"}],l=()=>{const o=d.value.price||0;i(),n.value==="Оплатить"?c({amount:o,methods:["SPLIT"],buttonContainerId:"#payButton",widgetContainerId:"#split-widget"}):c({amount:o,methods:["CARD"],buttonContainerId:"#payButton"})};return I(n,()=>{l()}),I(()=>d.value.price,()=>{l()}),Q(()=>{l()}),(o,a)=>(v(),m("div",qe,[a[2]||(a[2]=e("div",{class:"payment__address"},[e("h3",null,"Выберите способ оплаты")],-1)),e("div",Te,[(v(),m(F,null,z(u,t=>e("div",{key:t.name,class:"payment__method-item"},[E(e("input",{type:"radio",id:t.name,"onUpdate:modelValue":a[0]||(a[0]=r=>n.value=r),value:t.name},null,8,Ae),[[te,n.value]]),e("label",{for:t.name},[e("span",null,h(t.name),1),t.logo?(v(),m("img",{key:0,src:t.logo,alt:""},null,8,Me)):A("",!0)],8,De)])),64)),n.value==="Оплатить"?(v(),m("div",Oe,a[1]||(a[1]=[e("div",{id:"split-widget"},null,-1)]))):A("",!0)])]))}},Re=D(Ye,[["__scopeId","data-v-76410542"]]),Le={class:"cart"},Ne={class:"container"},Qe={class:"cart_main"},Ee={class:"cart_main__content"},Fe={class:"cart_products__w"},ze={class:"cart_products__head"},Je={class:"cart_select__all"},We=["checked"],je={class:"cart_products__list"},Ke={class:"cart_select__single"},He=["id","checked","onChange"],Ue=["for"],Ge={class:"cart_item__img"},Xe=["src"],Ze={class:"cart_item__content"},et={class:"cart_item__action"},tt={class:"cart_item__price"},lt={class:"list-block"},nt={class:"cart_totals"},st={class:"cart_total__head"},ot={class:"cart_total__body"},at={class:"cart_total__privacy"},it=N({__name:"cart",setup(C){const{carts:n,currentOrder:d}=M(),{updateCartItem:c,removeCartItem:i,createOrder:u}=j(),{deliveryPrice:l}=K(),o=P([]),a=Y(()=>o.value.length>0),t=(p,s)=>{p.quantity=s,c(p)},r=()=>{o.value.forEach(p=>{i(p)}),o.value=[]},b=p=>{o.value.includes(p)?o.value=o.value.filter(s=>s!==p):o.value.push(p)},_=p=>{p.target.checked?o.value=n.value.map(s=>s.id):o.value=[]},B=Y(()=>n.value.length>0&&o.value.length===n.value.length),S=Y(()=>n.value.reduce((p,s)=>p+s.price*s.quantity,0)),w=()=>{const p=n.value.map(f=>({product_id:f.id,name:f.title,quantity:f.quantity,price:f.price,color:f.color,thumbnail:f.thumbnail})),s=n.value.reduce((f,g)=>f+g.price*g.quantity,0);d.value={...d.value,line_items:p,price:s}};return I(n,w,{deep:!0}),Q(()=>{w()}),(p,s)=>{const f=U;return v(),m("div",Le,[e("div",Ne,[e("div",Qe,[e("div",Ee,[e("h2",null,"Корзина ("+h(y(n).length)+")",1),e("div",Fe,[e("div",ze,[e("div",Je,[e("input",{type:"checkbox",name:"select-all",id:"select-all",checked:B.value,onChange:_},null,40,We),s[0]||(s[0]=e("label",{for:"select-all"},"Выбрать все",-1))]),e("div",{class:le(["cart_delete",{active:a.value}]),onClick:r}," Удалить ",2)]),e("ul",je,[(v(!0),m(F,null,z(y(n),(g,H)=>(v(),m("li",{class:"cart_products__item",key:"carts-item-"+H},[e("div",Ke,[e("input",{type:"checkbox",name:"single-cart",id:g.id,checked:o.value.includes(g.id),onChange:O=>b(g.id)},null,40,He),e("label",{for:g.id},null,8,Ue)]),e("div",Ge,[e("img",{src:g.thumbnail,alt:""},null,8,Xe)]),e("div",Ze,[e("h3",null,h(g.title),1),e("ul",null,[e("li",null,[s[1]||(s[1]=e("p",null,"Цвет:",-1)),e("span",null,h(g.color),1)]),s[2]||(s[2]=e("li",null,[e("p",null,"Размеры:"),e("span",null,"180х150")],-1))])]),e("div",et,[e("div",tt,h(g.price)+" Р",1),k(G,{initialQuantity:g.quantity,onUpdateQuantity:O=>t(g,O),onClear:O=>y(i)(g.id)},null,8,["initialQuantity","onUpdateQuantity","onClear"])])]))),128))])]),e("div",lt,[k(Pe),k(xe),k(Re)])]),e("div",nt,[e("div",st,[s[3]||(s[3]=e("span",null,"Итого",-1)),e("p",null,h(S.value)+" P",1)]),e("div",ot,[e("ul",null,[e("li",null,[e("span",null,h(y(n).length)+" товара(ов) на сумму",1),e("p",null,h(S.value),1)]),e("li",null,[s[4]||(s[4]=e("span",null,"Доставка",-1)),e("p",null,h(y(l)),1)])])]),s[11]||(s[11]=e("div",{id:"payButton"},null,-1)),e("div",at,[s[8]||(s[8]=$(" Нажимая кнопку 'Оформить заказ', Вы принимаете условия соответствующей ")),k(f,{to:"/"},{default:R(()=>s[5]||(s[5]=[$("оферты: Оферты для физических лиц")])),_:1}),s[9]||(s[9]=$(" или ")),k(f,{to:"/"},{default:R(()=>s[6]||(s[6]=[$(" Оферты для юридических лиц и ИП")])),_:1}),s[10]||(s[10]=$(", Политики конфиденциальности, а также даете Согласие на ")),k(f,{to:"/"},{default:R(()=>s[7]||(s[7]=[$("обработку Ваших персональных данных и их передачу.")])),_:1})])])])])])}}}),yt=D(it,[["__scopeId","data-v-01494fae"]]);export{yt as default};
